{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/metta/Fomo4ClawAggregator/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///home/metta/Fomo4ClawAggregator/app/api/submissions/%5Bid%5D/vote/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { prisma } from '@/lib/db'\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { walletAddress, direction } = body as {\n      walletAddress?: string\n      direction?: number\n    }\n\n    if (!walletAddress || typeof walletAddress !== 'string') {\n      return NextResponse.json(\n        { error: 'walletAddress is required (connect wallet)' },\n        { status: 400 }\n      )\n    }\n    if (direction !== 1 && direction !== -1) {\n      return NextResponse.json(\n        { error: 'direction must be 1 (upvote) or -1 (downvote)' },\n        { status: 400 }\n      )\n    }\n\n    const submission = await prisma.submission.findUnique({\n      where: { id },\n    })\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 })\n    }\n\n    const voter = walletAddress.toLowerCase()\n\n    await prisma.vote.upsert({\n      where: {\n        submissionId_voterAddress: { submissionId: id, voterAddress: voter },\n      },\n      create: {\n        submissionId: id,\n        voterAddress: voter,\n        direction,\n      },\n      update: { direction },\n    })\n\n    const sum = await prisma.vote.aggregate({\n      where: { submissionId: id },\n      _sum: { direction: true },\n    })\n\n    return NextResponse.json({\n      voteCount: sum._sum.direction ?? 0,\n      message: direction === 1 ? 'Upvoted' : 'Downvoted',\n    })\n  } catch (e) {\n    console.error('Vote POST error:', e)\n    return NextResponse.json(\n      { error: 'Failed to vote' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KACpB,OAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,aAAa,EAAE,SAAS,EAAE,GAAG;QAKrC,IAAI,CAAC,iBAAiB,OAAO,kBAAkB,UAAU;YACvD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6C,GACtD;gBAAE,QAAQ;YAAI;QAElB;QACA,IAAI,cAAc,KAAK,cAAc,CAAC,GAAG;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgD,GACzD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,qHAAM,CAAC,UAAU,CAAC,UAAU,CAAC;YACpD,OAAO;gBAAE;YAAG;QACd;QACA,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,MAAM,QAAQ,cAAc,WAAW;QAEvC,MAAM,qHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACvB,OAAO;gBACL,2BAA2B;oBAAE,cAAc;oBAAI,cAAc;gBAAM;YACrE;YACA,QAAQ;gBACN,cAAc;gBACd,cAAc;gBACd;YACF;YACA,QAAQ;gBAAE;YAAU;QACtB;QAEA,MAAM,MAAM,MAAM,qHAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YACtC,OAAO;gBAAE,cAAc;YAAG;YAC1B,MAAM;gBAAE,WAAW;YAAK;QAC1B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,WAAW,IAAI,IAAI,CAAC,SAAS,IAAI;YACjC,SAAS,cAAc,IAAI,YAAY;QACzC;IACF,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}