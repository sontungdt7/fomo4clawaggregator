{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/metta/Fomo4ClawAggregator/app/api/image/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\n\nconst ALLOWED_HOSTS = ['cdn.dexscreener.com']\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const url = searchParams.get('url')\n    if (!url) {\n      return NextResponse.json({ error: 'Missing url' }, { status: 400 })\n    }\n\n    let decoded: string\n    try {\n      decoded = decodeURIComponent(url)\n    } catch {\n      return NextResponse.json({ error: 'Invalid url' }, { status: 400 })\n    }\n\n    const parsed = new URL(decoded)\n    if (!ALLOWED_HOSTS.includes(parsed.hostname)) {\n      return NextResponse.json({ error: 'Host not allowed' }, { status: 400 })\n    }\n\n    // token-icons return 422 from DexScreener - return 404 so img onError fires and TokenImage shows initials\n    if (decoded.includes('/token-icons/')) {\n      return new NextResponse(null, { status: 404 })\n    }\n\n    const res = await fetch(decoded, {\n      headers: {\n        Referer: 'https://dexscreener.com/',\n        'User-Agent': 'Mozilla/5.0 (compatible; Fomo4Claw/1.0)',\n      },\n      cache: 'force-cache',\n      next: { revalidate: 86400 },\n    })\n\n    if (!res.ok) {\n      return new NextResponse(null, { status: 404 })\n    }\n\n    const contentType = res.headers.get('content-type') ?? 'image/png'\n    const body = await res.arrayBuffer()\n\n    return new NextResponse(body, {\n      headers: {\n        'Content-Type': contentType,\n        'Cache-Control': 'public, max-age=86400, s-maxage=86400',\n      },\n    })\n  } catch (e) {\n    console.error('Image proxy error:', e)\n    return NextResponse.json({ error: 'Proxy failed' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,gBAAgB;IAAC;CAAsB;AAEtC,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,MAAM,aAAa,GAAG,CAAC;QAC7B,IAAI,CAAC,KAAK;YACR,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,IAAI;QACJ,IAAI;YACF,UAAU,mBAAmB;QAC/B,EAAE,OAAM;YACN,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,MAAM,SAAS,IAAI,IAAI;QACvB,IAAI,CAAC,cAAc,QAAQ,CAAC,OAAO,QAAQ,GAAG;YAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,0GAA0G;QAC1G,IAAI,QAAQ,QAAQ,CAAC,kBAAkB;YACrC,OAAO,IAAI,gJAAY,CAAC,MAAM;gBAAE,QAAQ;YAAI;QAC9C;QAEA,MAAM,MAAM,MAAM,MAAM,SAAS;YAC/B,SAAS;gBACP,SAAS;gBACT,cAAc;YAChB;YACA,OAAO;YACP,MAAM;gBAAE,YAAY;YAAM;QAC5B;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,OAAO,IAAI,gJAAY,CAAC,MAAM;gBAAE,QAAQ;YAAI;QAC9C;QAEA,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC,mBAAmB;QACvD,MAAM,OAAO,MAAM,IAAI,WAAW;QAElC,OAAO,IAAI,gJAAY,CAAC,MAAM;YAC5B,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;YACnB;QACF;IACF,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF"}}]
}